# Nok - マルチペインUIレイアウト設計

## 1. 概要
このドキュメントは、`nok` アプリケーションの新しいマルチペインUIレイアウトについて説明します。`lazygit` にインスパイアされた、より情報量の多いインターフェースを目指します。

## 2. 設計目標
- 主要な情報（ルーム、ユーザー、メッセージ）を一覧で表示し、状況把握を容易にする。
- 各機能へのアクセスを直感的にする。
- ターミナル画面を最大限に活用する。

## 3. レイアウト構成
ターミナル画面を大きく左右2つのペインに分割します。

```
+--------------------------------------+--------------------------------------+
| 左ペイン                             | 右ペイン                             |
|                                      |                                      |
| +----------------------------------+ |                                      |
| | ルーム一覧                       | |                                      |
| | (Rooms Pane)                     | | ルーム/ユーザー AA表現               |
| +----------------------------------+ |     (ASCII Art Pane)                 |
| | ユーザー一覧                     | |                                      |
| | (Users Pane)                     | |                                      |
| +----------------------------------+ |                                      |
| | メッセージ履歴                   | |                                      |
| | (Messages Pane)                  | |                                      |
| +----------------------------------+ |                                      |
|                                      |                                      |
+--------------------------------------+--------------------------------------+
```

### 3.1. 左ペイン
左ペインはさらに上下に3分割されます。

#### 3.1.1. ルーム一覧ペイン (Rooms Pane)
- **表示内容:**
    - 利用可能な全ルームのリスト。
    - 現在参加しているルーム名の前に `*` を表示。
    - 例:
        ```
        Rooms:
        * Main Room
          Meeting Room
          Break Room
        ```
- **操作:**
    - `↑`/`↓` または `k`/`j`: ルーム選択の移動。
    - `Enter`: 選択したルームへ移動。

#### 3.1.2. ユーザー一覧ペイン (Users Pane)
- **表示内容:**
    - 現在のルームにいるユーザー、または全ユーザーのリスト (表示範囲は設定やタブで切り替え可能)。
    - ユーザー名の前にステータスアイコンと色で状態を表示。
        - `●` (緑): オンライン
        - `○` (黄): 退席中
        - `◆` (赤): 取り込み中
        - `◇` (灰): オフライン
    - 例:
        ```
        Users (Main Room):
        ● Alice
        ○ Bob
        ◇ Charlie
        ```
- **操作:**
    - `↑`/`↓` または `k`/`j`: ユーザー選択の移動。
    - `n`: 選択したユーザーにノックする。
    - `Tab`: 次のフォーカス可能なペインへ移動。

#### 3.1.3. メッセージ履歴ペイン (Messages Pane)
- **表示内容:**
    - 現在選択中のルームのメッセージ履歴、または選択中のユーザーとのダイレクトメッセージ履歴。
    - フォーマット: `[送信時刻] <送信者>: メッセージ内容`
    - 新着メッセージは強調表示。
    - 例:
        ```
        Messages (Main Room):
        [10:00] <Alice>: おはよう！
        [10:01] <Bob>: こんにちは
        [10:02] <You>: @Alice kon kon
        ```
- **操作:**
    - `↑`/`↓` または `PageUp`/`PageDown`: メッセージ履歴のスクロール。
    - `i`: メッセージ入力モードへ切り替え（下部に一時的な入力欄表示または専用の入力ペインへフォーカス）。

### 3.2. 右ペイン
#### 3.2.1. ルーム/ユーザー AA表現ペイン (ASCII Art Pane)
- **表示内容:**
    - 現在選択されているルームの様子をアスキーアートで表現。
    - ルーム内にいるユーザーの位置やステータスをAAで視覚的に示す。
    - ユーザーアイコンはステータスに応じて変化 (例: オンラインなら `(^^)`, 退席中なら `(..)` など)。
    - ノックされたユーザーは一時的に点滅するなどのエフェクト。
    ```
    +--------------------------------------+
    |           [ Main Room ]              |
    |                                      |
    |    (^^) Alice      Bob (..)         |
    |                                      |
    |                      Charlie (xx)    |
    |                                      |
    |   You (^^)                           |
    +--------------------------------------+
    ```
- **操作:**
    - 基本的に表示のみ。将来的にはAA内のオブジェクトを選択してアクションを起こせる可能性も考慮。

## 4. キーボードショートカット（案）
### グローバル
- `q`: アプリケーション終了
- `Ctrl + r` または `1`: ルーム一覧ペインにフォーカス
- `Ctrl + u` または `2`: ユーザー一覧ペインにフォーカス
- `Ctrl + m` または `3`: メッセージ履歴ペインにフォーカス ( `c` はチャットコマンドと衝突するため `m` を提案)
- `Ctrl + p` または `4`: AA表現ペインにフォーカス ( `a` は別機能で使う可能性を考慮し `p` (presentation/pane) を提案)
- `Tab` / `Shift + Tab`: ペイン間のフォーカス移動

### 各ペイン内
- **ルーム一覧ペイン:**
    - `↑`/`↓` または `k`/`j`: ルーム選択
    - `Enter`: ルーム参加
- **ユーザー一覧ペイン:**
    - `↑`/`↓` または `k`/`j`: ユーザー選択
    - `n`: 選択中ユーザーにノック
    - `Enter` または `m`: 選択中ユーザーとのダイレクトメッセージ開始 (メッセージペインがDMモードに遷移)
- **メッセージ履歴ペイン:**
    - `↑`/`↓` または `PageUp`/`PageDown`: スクロール
    - `i`: メッセージ入力モード開始
    - `Esc`: 入力モードキャンセル
- **入力モード時:**
    - `Enter`: メッセージ送信
    - `Esc`: 入力キャンセル
    - 通常のテキスト編集キー

## 5. UIコンポーネント (ratatui)
- **全体レイアウト**: `Layout` と `Constraint` を使用して左右ペイン、左ペイン内の3分割を実現。ペインの境界線も描画。
- **各ペインのタイトル**: `Block` と `Title` を使用。
- **ルーム一覧**: `List` ウィジェット。選択中のアイテムはスタイル変更でハイライト。
- **ユーザー一覧**: `List` ウィジェット。各アイテムは複数の `Span` を組み合わせ、ステータスアイコン (色付き記号) とユーザー名を表示。
- **メッセージ履歴**: `Paragraph` ウィジェット (Text Area的な使い方) または `List` ウィジェット。表示行数を超えた場合のスクロール処理が必要。
- **AA表現**: `Paragraph` ウィジェット。AAは文字列として動的に生成・更新。
- **入力欄**: `Paragraph` ウィジェットを画面下部、またはメッセージペインの下に表示。

## 6. その他考慮事項
- **テーマ/カラーリング**: `lazygit` のようなダークテーマを基調とし、ステータスや通知に応じてアクセントカラーを使用。カスタマイズ可能にすることも将来的には検討。
- **レスポンシブ対応**: ターミナルのサイズ変更に合わせて各ペインのサイズが動的に調整される。最小表示サイズを定義し、それを下回る場合は警告を表示するか、一部情報を省略する。
- **通知エリア**: ノック通知、エラーメッセージ、重要なシステムメッセージは、画面下部のステータスバー、または専用のポップアップウィンドウで一時的に表示。
- **フォーカス表示**: 現在フォーカスされているペインの境界線を強調表示するなど、視覚的に分かりやすくする。
- **設定**: 各ペインの表示/非表示、レイアウト比率などを設定ファイルでカスタマイズできると良い。 