# 概要
nok のバックエンドは、シンプルでスケーラブル、かつリアルタイムなやりとりを実現するために設計されています。モジュール化されたイベント駆動アーキテクチャを採用しており、RESTとWebSocketの両方の通信方式をサポートします。

```
クライアント (nok TUI)
   |
   |-- REST API ------------------------→ 認証 & ユーザー管理
   |                                        |
   |-- WebSocket ------------------------→ WebSocketハブ
                                              |
                                            セッションストア（Redis）
                                              |
                                         イベントディスパッチャー
                                              |
                                      永続ストア（SQLite/Supabase）
```

# コンポーネント

1. REST API（FastAPIまたはExpress）

処理内容：
	•	認証（/login, /logout）
	•	ステータス更新（/status）
	•	設定情報の取得
	•	基本的なクエリ（例：/users, /rooms）

2. WebSocketサーバー

処理内容：
	•	ノックやメッセージのリアルタイム配信
	•	ルーム内の在室状況の更新
	•	接続のライフサイクルイベント

3. 認証モジュール
	•	シンプルなトークンベース認証（独自実装またはJWT）
	•	セッショントークンの検証と発行

4. セッションストア
	•	Redisを使用して以下を管理：
	•	アクティブなユーザーセッション
	•	オンライン／オフラインの状態
	•	WebSocketのソケットとの紐づけ

5. イベントディスパッチャー
	•	インメモリのpub/sub または Redisベースのチャネルシステム
	•	関連するWebSocketクライアントへイベントをブロードキャスト
	•	例：ノックイベント、ステータス変更

6. 永続ストア
	•	ローカル／開発環境ではSQLite
	•	ホスティング環境ではSupabase/PostgreSQL
	•	保存対象：
	•	ユーザー設定
	•	メッセージログ
	•	ルーム定義

⚙️ デプロイ方法

小規模チームやテスト用には：
	•	すべてを単一プロセスまたはDocker Composeで実行

本番環境では：
	•	APIサーバーとWebSocketサーバーを別々にデプロイ
	•	RedisおよびSupabaseをスケーラブルなバックエンドサービスとして利用
